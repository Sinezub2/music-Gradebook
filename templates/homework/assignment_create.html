{% extends "base.html" %}
{% block title %}Создать задание{% endblock %}
{% block content %}
  <h1>Создать задание</h1>

  <div class="card">
    <form method="post" class="form" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="form-row">
        {% if fixed_course %}
          <label>Класс</label>
          <div>{{ fixed_course.name }}</div>
          <input type="hidden" name="course" value="{{ fixed_course.id }}"/>
        {% else %}
          <label>{{ form.course.label }}</label>
          {{ form.course }}
          {% if form.course.errors %}<div class="error">{{ form.course.errors }}</div>{% endif %}
          <div class="muted small">
            Чтобы выбрать учеников, сначала выберите курс и обновите страницу.
          </div>
          <div class="muted small">
            Быстрый способ: выберите курс → нажмите “Обновить список учеников”.
          </div>
        {% endif %}
      </div>

      {% if not fixed_course %}
        <div class="form-row">
          <button class="btn" type="button"
                  onclick="window.location.href='/assignments/create/?course=' + document.getElementById('id_course').value;">
            Обновить список учеников
          </button>
        </div>
      {% endif %}

      <hr style="border:0; border-top:1px solid var(--border); margin: 8px 0 12px;"/>

      <div class="form-row">
        <label>{{ form.title.label }}</label>
        {{ form.title }}
        {% if form.title.errors %}<div class="error">{{ form.title.errors }}</div>{% endif %}
      </div>

      <div class="form-row">
        <label>{{ form.description.label }}</label>
        {{ form.description }}
        {% if form.description.errors %}<div class="error">{{ form.description.errors }}</div>{% endif %}
      </div>

      <div class="form-row">
        <label>{{ form.due_date.label }}</label>
        {{ form.due_date }}
        {% if form.due_date.errors %}<div class="error">{{ form.due_date.errors }}</div>{% endif %}
      </div>

      <div class="form-row">
        <label>{{ form.attachment.label }}</label>
        {{ form.attachment }}
        {% if form.attachment.errors %}<div class="error">{{ form.attachment.errors }}</div>{% endif %}
      </div>

      <div class="form-row">
        <label>{{ form.students.label }}</label>
        {% if form.students.field.choices %}
          {{ form.students }}
        {% else %}
          {% if fixed_course %}
            <div class="muted">В классе пока нет учеников.</div>
          {% else %}
            <div class="muted">Сначала выберите курс, чтобы увидеть учеников.</div>
          {% endif %}
        {% endif %}
        {% if form.students.errors %}<div class="error">{{ form.students.errors }}</div>{% endif %}
      </div>

      {% if form.non_field_errors %}<div class="error">{{ form.non_field_errors }}</div>{% endif %}

      <button class="btn" type="submit">Создать</button>
      <a class="btn" href="/assignments/">Отмена</a>
    </form>
  </div>

  <p class="muted small">
    После создания: для выбранных учеников автоматически создаются записи назначения и пустые Grade записи в gradebook.
  </p>
{% endblock %}
