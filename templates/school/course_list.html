<!-- templates/school/course_list.html -->
{% extends "base.html" %}
{% block title %}Курсы{% endblock %}
{% block content %}
  <h1>Курсы</h1>

  {% if mode == "no_class" %}
    <p class="muted">{{ no_class_message }}</p>
  {% elif mode == "parent_pick" %}
    <p>Выберите ребёнка:</p>
    {% if children_links %}
      <ul class="list">
        {% for link in children_links %}
          <li>
            <span>{{ link.child.get_full_name|default:"Без имени" }}</span>
            <a class="muted" href="/courses/?student={{ link.child.id }}">Открыть курсы</a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Нет детей.</p>
    {% endif %}
  {% else %}
    {% if student %}
      <p class="muted">Ученик: {{ student.get_full_name|default:"Без имени" }} · Цикл: {{ student.profile.get_cycle_display }}</p>
    {% endif %}

    {% if mode == "teacher" or mode == "admin" %}
      <form method="get" class="form-row" style="margin: 12px 0;">
        <label class="muted small" for="cycle">Цикл учеников</label>
        <select id="cycle" name="cycle" class="input" onchange="this.form.submit()">
          <option value="">Все циклы</option>
          {% for value, label in cycle_options %}
            <option value="{{ value }}"{% if cycle == value %} selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
        <noscript><button class="btn" type="submit">Показать</button></noscript>
      </form>
    {% endif %}

    {% if courses %}
      <ul class="list">
        {% for c in courses %}
          <li>
            <a href="/courses/{{ c.id }}/{% if mode == 'parent_child' %}?student={{ student.id }}{% endif %}">{{ c.name }}</a>
            <span class="tag">{{ c.course_type.name }}</span>
            {% if mode == "student" %}
              <a class="muted" href="/courses/{{ c.id }}/grades/">Результаты</a>
            {% elif mode == "parent_child" %}
              <a class="muted" href="/courses/{{ c.id }}/grades/?student={{ student.id }}">Результаты</a>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Курсов нет.</p>
    {% endif %}
  {% endif %}
{% endblock %}
