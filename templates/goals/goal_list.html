{% extends "base.html" %}
{% block title %}Годовой план{% endblock %}
{% block content %}
  {% if can_edit %}
    <div style="margin-bottom: 16px;">
      <a class="btn" href="/goals/create/{% if selected_student_id %}?student={{ selected_student_id }}{% endif %}">Создать годовую цель</a>
      {% if can_bulk_delete and not select_mode %}
        <a class="btn" href="{{ select_url }}">Удалить</a>
      {% endif %}
      {% if can_bulk_delete and select_mode %}
        <a class="btn" href="{{ cancel_select_url }}">Отмена</a>
      {% endif %}
    </div>
  {% endif %}

  {% if goals %}
    {% if select_mode %}
      <form method="post" action="/goals/bulk-delete/" onsubmit="return confirm('Удалить выбранные элементы?')">
        {% csrf_token %}
        {% if selected_student_id %}
          <input type="hidden" name="student" value="{{ selected_student_id }}"/>
        {% endif %}
        <div style="margin: 0 0 10px;">
          <button class="btn" type="submit">Удалить выбранное</button>
          <a class="btn" href="{{ cancel_select_url }}">Отмена</a>
        </div>
    {% endif %}
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            {% if select_mode and can_bulk_delete %}
              <th></th>
            {% endif %}
            <th>Годовая цель</th>
            <th>Комментарий</th>
            <th>Преподаватель</th>
          </tr>
        </thead>
        <tbody>
          {% for row in goals %}
            <tr>
              {% if select_mode and can_bulk_delete %}
                <td>
                  {% if row.can_delete %}
                    <input type="checkbox" name="selected_ids" value="{{ row.goal.id }}"/>
                  {% endif %}
                </td>
              {% endif %}
              <td><strong>{{ row.goal.title }}</strong></td>
              <td>{% if row.goal.details %}{{ row.goal.details }}{% else %}<span class="muted">—</span>{% endif %}</td>
              <td>{% if row.goal.teacher %}{{ row.goal.teacher.username }}{% else %}<span class="muted">—</span>{% endif %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% if select_mode %}
      </form>
    {% endif %}
  {% else %}
    <p class="muted">Пока нет годовых целей.</p>
  {% endif %}
{% endblock %}
