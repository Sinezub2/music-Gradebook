{% extends "base.html" %}
{% block title %}Журнал посещаемости{% endblock %}
{% block content %}
  <h1>Журнал посещаемости</h1>

  <div class="card">
    <form method="get" class="form">
      <div class="form-row">
        <label for="course">Курс</label>
        <select id="course" name="course">
          <option value="">Выберите курс</option>
          {% for c in courses %}
            <option value="{{ c.id }}"{% if course_id|add:"" == c.id|add:"" %} selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-row">
        <label for="month">Месяц</label>
        <input id="month" type="month" name="month" value="{{ month_value }}">
      </div>
      <button class="btn" type="submit">Показать</button>
    </form>
  </div>

  <div class="card">
    {% if not course_id %}
      <p class="muted">Выберите курс, чтобы увидеть журнал посещаемости.</p>
    {% elif not students %}
      <p class="muted">Нет учеников для выбранного курса.</p>
    {% elif not rows %}
      <p class="muted">Нет уроков за выбранный месяц.</p>
    {% else %}
      <div class="table-wrap">
        <table class="table">
          <thead>
            <tr>
              <th>Дата</th>
              {% for student in students %}
                <th>{{ student.get_full_name|default:student.username }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
              <tr>
                <td>{{ row.date|date:"d.m.Y" }}</td>
                {% for cell in row.cells %}
                  <td class="attendance-cell">
                    {% if cell.attended %}
                      <span class="attendance-yes">✓</span>
                    {% elif cell.attended == False %}
                      <span class="attendance-no">—</span>
                    {% else %}
                      <span class="attendance-empty">—</span>
                    {% endif %}
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr>
              <th>Итого (месяц)</th>
              {% for total in totals %}
                <th class="attendance-cell">{{ total.label }}</th>
              {% endfor %}
            </tr>
          </tfoot>
        </table>
      </div>
      <p class="muted small">Общее рабочее время за месяц: {{ overall_total_label }}.</p>
    {% endif %}
  </div>
{% endblock %}
